<p><span style=";font-family:微软雅黑;font-size:19px"><span style="font-family:微软雅黑">在</span>mac里面用源码包安装的方式搭好了LAMP环境，Apache可以正常访问，PHP也可以正常解析。但是，开始装PHP的扩展的时候，遇到了坑，走了很多绕路。<span style="font-family: 微软雅黑; font-size: 19px; color: rgb(255, 0, 0);">文末有安装步骤总结，心急的童鞋可以直接跳转到文末，略过中途坎坷的坑。</span></span></p><p><span style=";font-family:微软雅黑;font-size:19px">&nbsp;</span></p><p><span style=";font-family:微软雅黑;font-size:19px"><span style="font-family:微软雅黑">首先，按照装</span>PHP扩展的惯例，进到扩展目录去phpize</span></p><p style="text-indent:28px"><span style=";font-family:微软雅黑;font-size:19px">1. cd /soft/php-7.0.7/ext/openssl &nbsp;&nbsp;&nbsp;#我的源码包都放在/soft里面，请自动替换为你的目录</span></p><p style="text-indent:28px"><span style=";font-family:微软雅黑;font-size:19px">2. 执行phpize<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/usr/local/php/bin/phpize</span></p><p style="text-indent:28px"><span style=";font-family:微软雅黑;font-size:19px">3. 执行检测（结果在这一步遇到了问题）<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;./configure --with-openssl --with-php-config=/usr/local/php/bin/php-config</span></p><p style="text-indent:28px"><span style="font-family: 微软雅黑; font-size: 19px;">&nbsp;</span></p><p><img src="./images/15/1511434534.png" title="1511434534.png" alt="图片1.png"/><img src="./images/15/1511434569.png" title="1511434569.png" alt="图片2.png"/></p><p><span style="text-indent: 28px; font-family: 微软雅黑; font-size: 19px;"><br/></span></p><p><span style="text-indent: 28px; font-family: 微软雅黑; font-size: 19px;">可以看到出现了一个</span><span style="text-indent: 28px; font-family: 微软雅黑; font-size: 19px;">error，错误信息是: &nbsp;Cannot find OpenSSL&#39;s &lt;evp.h&gt;</span></p><p><span style="font-family: 微软雅黑; font-size: 19px; text-indent: 28px;"><br/></span></p><p><span style="font-family: 微软雅黑; font-size: 19px; text-indent: 28px;">百度了一下，在</span><span style="font-family: 微软雅黑; font-size: 19px; text-indent: 28px;">centos里面这种错误太特么常见了，解决方法也很简单：&nbsp;</span></p><p><span style="font-family: 微软雅黑; font-size: 19px; text-indent: 28px;">&nbsp;&nbsp;&nbsp;&nbsp;yum -y install openssl openssl-devel</span></p><p><span style="text-indent: 28px; font-family: 微软雅黑; font-size: 19px;"><br/></span></p><p><span style="text-indent: 28px; font-family: 微软雅黑; font-size: 19px;">可是在</span><span style="text-indent: 28px; font-family: 微软雅黑; font-size: 19px;">mac里面却没有yum这玩意儿，没事，mac有homebrew可以代替（不知道的自己去查查）。</span></p><p><span style="font-family: 微软雅黑; font-size: 19px; text-indent: 28px;"><br/></span></p><p><span style="font-family: 微软雅黑; font-size: 19px; text-indent: 28px;">开心的执行</span><span style="font-family: 微软雅黑; font-size: 19px; text-indent: 28px;">: &nbsp;brew install openssl openssl-devel &nbsp;结果人家只认识openssl，根本不认识 openssl-devel</span></p><p style="text-indent:28px"><img src="./images/15/1511434622.png" title="1511434622.png" alt="图片3.png"/><br/><span style="font-family: 微软雅黑; font-size: 19px;">所以退而求其次，先装个</span><span style="font-family: 微软雅黑; font-size: 19px;">openssl试试： brew install opensll</span></p><p style="text-indent:28px"><img src="./images/15/1511434665.png" title="1511434665.png" alt="图片4.png"/><br/><span style="font-family: 微软雅黑; font-size: 19px;"><br/>好，安装成功，</span><span style="font-family: 微软雅黑; font-size: 19px;">very高兴。赶紧去到 cd /soft/php-7.0.7/ext/openssl 目录下试试，</span><span style="font-family: 微软雅黑; font-size: 19px;">再次执行检测<br/></span><span style="font-family: 微软雅黑; font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;./configure --with-openssl --with-php-config=/usr/local/php/bin/php-config<br/></span><span style="font-family: 微软雅黑; font-size: 19px;"><br/>Fuck，然并卵，错误依旧。从这一刻开始，整个思维就进入了死胡同，总觉得这个openssl-devel是必须安装的东西，不然就装不了php 的openssl这个扩展，所以，进行了漫长的百度和谷歌，搜索的关键字包括：&nbsp;<br/></span><span style="font-family: 微软雅黑; font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mac php openssl扩展</span></p><p style="text-indent:28px"><span style=";font-family:微软雅黑;font-size:19px">Cannot find OpenSSL&#39;s &lt;evp.h&gt;</span></p><p style="text-indent:28px"><span style=";font-family:微软雅黑;font-size:19px">Brew 安装openssl</span></p><p style="text-indent:28px"><span style=";font-family:微软雅黑;font-size:19px">Openssl-devel 包</span></p><p style="text-indent:28px"><span style=";font-family:微软雅黑;font-size:19px">... ...<br/></span><span style="font-family: 微软雅黑; font-size: 19px;"><br/>说到</span><span style="font-family: 微软雅黑; font-size: 19px;">openssl-devel的包倒是真的找到一个，不过不是tar包，而是rpm的，赶紧下载了下来。既然是rpm包，肯定得使用rpm的方式来装，所以又用brew安装rpm。</span></p><p><span style=";font-family:微软雅黑;font-size:19px"><span style="font-family:微软雅黑">结果连</span>rpm的第一个依赖libmagic都装不了，这货的下载地址报404，将地址复制到浏览器一看，真的找不到。仔细一对比发现原来是版本号的原因，5.30.tar.gz已经没了，换成了 5.32.tar.gz。</span></p><p><span style=";font-family:微软雅黑;font-size:19px"><span style="font-family:微软雅黑">所以要修改</span>brew安装时依赖包的下载地址，执行了brew update，报错依旧404。没办法执行 brew edit libmagic 直接修改url地址和sha256，终于搞定。花了好久才把rpm装上，结果一运行rpm安装，才知道，自己又跑偏了： </span></p><p style="text-indent:28px"><span style=";font-family:微软雅黑;font-size:19px">rpm -ivh openssl-devel-1.0.2k-8.el7.x86_64.rpm<br/></span></p><p style="text-indent:28px"><span style=";font-family:微软雅黑;font-size:19px"><img src="./images/15/1511434712.png" title="1511434712.png" alt="图片5.png"/></span></p><p><span style=";font-family:微软雅黑;font-size:19px">&nbsp;</span></p><p><span style=";font-family:微软雅黑;font-size:19px"><span style="font-family:微软雅黑">看到这一堆依赖，想都没想就放弃了这条路。慢慢得出些结论：</span> openssl-devel 仅仅包含一些头文件，不是一个单独的包；要装好PHP的openssl扩展，只需要安装了openssl就行了。</span></p><p><span style=";font-family:微软雅黑;font-size:19px">but为啥我的不行呢？？？我的openssl已经装好了啊，甚至安装目录我都看了，在执行检测的时候还手动指定了这个目录呢，还是没用</span></p><p><span style=";font-family:微软雅黑;font-size:19px">&nbsp;&nbsp;&nbsp;&nbsp;./configure --with-openssl --with-php-config=/usr/local/php/bin/php-config --with-openssl-dir=/usr/local/Cellar/openssl/1.0.2m<br/><br/></span></p><p><span style=";font-family:微软雅黑;font-size:19px"></span></p><p><span style="font-family: 微软雅黑, &quot;Microsoft YaHei&quot;; text-indent: 28px; font-size: 18px;">望着 ./configure --with-openssl --with-php-config=/usr/local/php/bin/php-config 报出来的Cannot find OpenSSL&#39;s &lt;evp.h&gt;错误发了好一阵呆，感觉束手无策。出去抽了一根烟回来，突然灵光一闪，这玩意不就是个报错吗，那这错误是谁报出来的呢？是./configure文件，所以开始 vim ./configure ，并且查找 evp.h，从这一刻开始，思维终于走上了正常渠道。在找到evp.h的附近看到了我想看的东西：</span></p><p><br/></p><p style="text-indent:28px"><img src="./images/15/1511434741.png" title="1511434741.png" alt="图片6.png"/><span style=";font-family:微软雅黑;font-size:19px">&nbsp;</span></p><p><span style=";font-family:微软雅黑;font-size:19px"><span style="font-family:微软雅黑">好像意思是循环从这几个地方去找</span>evp.h文件，然而我看了看brew安装的openssl的安装目录是：/usr/local/Cellar/openssl/1.0.2m，差了一丢丢啊，赶紧将这玩意复制一份过去：</span></p><p style="text-indent:28px"><span style=";font-family:微软雅黑;font-size:19px">sudo cp /usr/local/Cellar/openssl/1.0.2m /usr/local/openssl<br/></span><span style="font-family: 微软雅黑; font-size: 19px;">然后再执行</span><span style="font-family: 微软雅黑; font-size: 19px;">&nbsp;&nbsp;</span></p><p style="text-indent:28px"><span style=";font-family:微软雅黑;font-size:19px">./configure --with-openssl --with-php-config=/usr/local/php/bin/php-config</span></p><p><span style=";font-family:微软雅黑;font-size:19px"><span style="font-family:微软雅黑">泪牛满面啊，终于可以了。然后就是</span> make ，最后 sudo make install。<br/></span></p><p><span style=";font-family:微软雅黑;font-size:19px"><br/></span></p><p><span style="font-family: 微软雅黑; font-size: 19px; color: rgb(255, 0, 0);">安装步骤总结：</span></p><p style="text-indent:28px"><span style="color: rgb(255, 0, 0); font-family: 微软雅黑; font-size: 19px;">1.&nbsp;<span style="color: rgb(255, 0, 0); font-family: 微软雅黑;">安装</span>openssl</span></p><p style="margin-left:28px;text-indent:28px"><span style="font-family: 微软雅黑; font-size: 19px; color: rgb(255, 0, 0);">brew install openssl</span></p><p style="text-indent:28px"><span style="color: rgb(255, 0, 0); font-family: 微软雅黑; font-size: 19px;">2. 找到openssl的安装目录，copy一份到/usr/local下面<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sudo cp /usr/local/Cellar/openssl/1.0.2m /usr/local/openssl</span></p><p style="text-indent:28px"><span style="font-family: 微软雅黑; font-size: 19px; color: rgb(255, 0, 0);">3. 进入PHP源码包的扩展目录，我的源码包都放在/soft里面，请自动替换为你的目录</span></p><p style="margin-left:28px;text-indent:28px"><span style="font-family: 微软雅黑; font-size: 19px; color: rgb(255, 0, 0);">cd /soft/php-7.0.7/ext/openssl </span></p><p style="text-indent:28px"><span style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0); font-family: 微软雅黑; font-size: 19px;">4. 执行phpize<br/></span><span style="color: rgb(255, 0, 0); font-family: 微软雅黑; font-size: 19px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/usr/local/php/bin/phpize</span></span></p><p style="text-indent:28px"><span style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0); font-family: 微软雅黑; font-size: 19px;">5. 执行检测</span> &nbsp;</span></p><p style="margin-left:28px;text-indent:28px"><span style="font-family: 微软雅黑; font-size: 19px; color: rgb(255, 0, 0);">./configure --with-openssl --with-php-config=/usr/local/php/bin/php-config </span></p><p style="text-indent:28px"><span style="color: rgb(255, 0, 0); font-family: 微软雅黑; font-size: 19px;">6.&nbsp;<span style="color: rgb(255, 0, 0); font-family: 微软雅黑;">执行</span>make和make install<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; make</span></p><p style="margin-left:56px"><span style="font-family: 微软雅黑; font-size: 19px; color: rgb(255, 0, 0);">sudo make install</span></p><p><span style=";font-family:微软雅黑;font-size:19px">&nbsp;</span></p><p><br/></p>